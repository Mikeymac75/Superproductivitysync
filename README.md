# Super Productivity to Nextcloud Calendar Sync 

This project is a bridge between [Super Productivity](https://super-productivity.com/) and [Nextcloud Calendar](https://nextcloud.com/).

It reads your tasks from the `backup.json` file (generated by Super Productivity and stored on Nextcloud) and synchronizes tasks with a **Due Date** to your Nextcloud Calendar. This allows you to view your tasks on your phone (e.g., via DAVx5) or use them in Home Assistant automations.

## Features

- **Read:** Fetches `backup.json` from your Nextcloud WebDAV URL.
- **Process:** Filters for tasks that have a valid due date.
- **Write:** Pushes these tasks as events to your specified Nextcloud Calendar.
- **Sync:** Prevents duplicates by checking if the task already exists on the calendar.
- **Schedule:** Runs automatically every 15 minutes.

## Prerequisites

- A **Nextcloud** instance with the Calendar app installed.
- **Super Productivity** configured to sync `backup.json` to your Nextcloud files.
- **Docker** and **Docker Compose** installed on your server (e.g., Proxmox LXC).

## Configuration

All configuration is done in the `docker-compose.yml` file. You need to update the environment variables to match your setup.

| Variable | Description | Example |
| :--- | :--- | :--- |
| `WEBDAV_URL` | The URL to your `backup.json` file. | `http://nextcloud.local/remote.php/dav/files/myuser/SuperProductivity/backup.json` |
| `WEBDAV_USERNAME` | Your Nextcloud username for file access. | `myuser` |
| `WEBDAV_PASSWORD` | Your Nextcloud password (or App Password). | `secret123` |
| `CALDAV_URL` | The base CalDAV URL for your user. | `http://nextcloud.local/remote.php/dav/calendars/myuser/` |
| `CALDAV_USERNAME` | Your Nextcloud username for calendar access. | `myuser` |
| `CALDAV_PASSWORD` | Your Nextcloud password (or App Password). | `secret123` |
| `CALENDAR_NAME` | The display name of the calendar to sync to. | `Personal` |

### Finding your URLs in Nextcloud

1.  **WebDAV URL:** Go to the Files app in Nextcloud, find your `backup.json`, click the three dots, and check "Details" or "Copy WebDAV link". Note: You might need to copy the link for the folder and append the filename if the UI doesn't give the direct file link.
2.  **CalDAV URL:** Go to the Calendar app in Nextcloud, click "Calendar settings & link" on the left sidebar for the specific calendar, and copy the "CalDAV link". You usually want the base user URL which looks like `.../dav/calendars/USERNAME/`.

## How to Run

1.  **Download/Create Files:** Ensure you have `main.py`, `requirements.txt`, `Dockerfile`, and `docker-compose.yml` in a folder on your server.
2.  **Edit Configuration:** Open `docker-compose.yml` and fill in your details.
3.  **Start the Container:**
    Run the following command in the terminal inside that folder:

    ```bash
    docker-compose up -d --build
    ```

    - `-d`: Runs the container in the background (detached mode).
    - `--build`: Rebuilds the image to ensure any changes are applied.

4.  **View Logs:**
    To see if it's working or check for errors:

    ```bash
    docker-compose logs -f
    ```

5.  **Stop:**
    To stop the container:

    ```bash
    docker-compose down
    ```

## Notes

- The script creates events with IDs like `super-productivity-{task_id}` to track them.
- If you change a due date in Super Productivity, the script attempts to update the calendar event on the next run.
- Runs every 15 minutes by default.
